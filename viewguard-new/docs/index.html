<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ViewGuard ëª¨ë‹ˆí„°ë§</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f7fa;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* í—¤ë” */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        /* í†µê³„ */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-box h3 {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .stat-box .number {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
        }

        /* ì»¨íŠ¸ë¡¤ */
        .controls {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
        }

        button:hover {
            background: #5568d3;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* ì•Œë¦¼ ëª©ë¡ */
        .alerts {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .alert-item {
            background: #fff5f5;
            border-left: 4px solid #ef4444;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
        }

        .alert-item.closed {
            background: #f0fdf4;
            border-left-color: #10b981;
        }

        .alert-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .alert-time {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
        }

        .alert-info {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .alert-info span {
            background: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .view-btn {
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 5px;
            text-decoration: none;
            font-size: 0.9em;
            display: inline-block;
            margin-top: 10px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .empty {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <div class="header">
            <h1>ğŸ‘ï¸ ViewGuard ì¡¸ìŒ ëª¨ë‹ˆí„°ë§</h1>
            <p>ì‹¤ì‹œê°„ ì•Œë¦¼ ì‹œìŠ¤í…œ</p>
        </div>

        <!-- í†µê³„ -->
        <div class="stats">
            <div class="stat-box">
                <h3>ì „ì²´ ê°ì§€</h3>
                <div class="number" id="total">0</div>
            </div>
            <div class="stat-box">
                <h3>ì˜¤ëŠ˜</h3>
                <div class="number" id="today">0</div>
            </div>
            <div class="stat-box">
                <h3>ë¯¸í™•ì¸</h3>
                <div class="number" id="open">0</div>
            </div>
        </div>

        <!-- ì»¨íŠ¸ë¡¤ -->
        <div class="controls">
            <div>
                ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: <strong id="lastUpdate">-</strong>
            </div>
            <button id="refreshBtn">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        </div>

        <!-- ì•Œë¦¼ ëª©ë¡ -->
        <div class="alerts">
            <h2 style="margin-bottom: 20px;">ğŸ“‹ ìµœê·¼ ì•Œë¦¼</h2>
            <div id="alertsList">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://api.github.com/repos/tonyhwang1004/viewguard-monitor/issues';
        
        // ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        async function loadData() {
            try {
                const response = await fetch(`${API_URL}?state=all&per_page=50`);
                const issues = await response.json();
                
                updateStats(issues);
                displayAlerts(issues);
                updateTime();
                
            } catch (error) {
                document.getElementById('alertsList').innerHTML = `
                    <div class="empty">
                        <p>âš ï¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</p>
                    </div>
                `;
            }
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats(issues) {
            const today = new Date().toISOString().split('T')[0];
            const todayIssues = issues.filter(i => i.created_at.startsWith(today));
            const openIssues = issues.filter(i => i.state === 'open');

            document.getElementById('total').textContent = issues.length;
            document.getElementById('today').textContent = todayIssues.length;
            document.getElementById('open').textContent = openIssues.length;
        }

        // ì•Œë¦¼ í‘œì‹œ
        function displayAlerts(issues) {
            const list = document.getElementById('alertsList');
            
            if (issues.length === 0) {
                list.innerHTML = `
                    <div class="empty">
                        <p>âœ… ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤</p>
                    </div>
                `;
                return;
            }

            list.innerHTML = issues.slice(0, 20).map(issue => {
                const date = new Date(issue.created_at);
                const body = issue.body || '';
                
                // ì •ë³´ ì¶”ì¶œ
                const ear = body.match(/EAR[:\s]+([0-9.]+)/i);
                const tilt = body.match(/Head Tilt[:\s]+([0-9.]+)/i);
                const seat = issue.title.match(/(CH\d+)/);
                
                return `
                    <div class="alert-item ${issue.state}">
                        <div class="alert-title">
                            ${issue.state === 'closed' ? 'âœ…' : 'ğŸš¨'} ${issue.title}
                        </div>
                        <div class="alert-time">
                            ${formatTime(date)}
                        </div>
                        <div class="alert-info">
                            ${ear ? `<span>EAR: ${ear[1]}</span>` : ''}
                            ${tilt ? `<span>ê°ë„: ${tilt[1]}Â°</span>` : ''}
                            ${seat ? `<span>ì¢Œì„: ${seat[1]}</span>` : ''}
                            <span>ìƒíƒœ: ${issue.state === 'open' ? 'ë¯¸í™•ì¸' : 'í™•ì¸ì™„ë£Œ'}</span>
                        </div>
                        <a href="${issue.html_url}" target="_blank" class="view-btn">
                            ğŸ“„ ìƒì„¸ë³´ê¸°
                        </a>
                    </div>
                `;
            }).join('');
        }

        // ì‹œê°„ í¬ë§·
        function formatTime(date) {
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);

            if (minutes < 1) return 'ë°©ê¸ˆ ì „';
            if (minutes < 60) return `${minutes}ë¶„ ì „`;
            if (hours < 24) return `${hours}ì‹œê°„ ì „`;
            
            return date.toLocaleDateString('ko-KR', {
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // ì—…ë°ì´íŠ¸ ì‹œê°„
        function updateTime() {
            const now = new Date();
            document.getElementById('lastUpdate').textContent = 
                now.toLocaleTimeString('ko-KR');
        }

        // ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼
        document.getElementById('refreshBtn').addEventListener('click', async function() {
            this.disabled = true;
            this.textContent = 'â³ ì—…ë°ì´íŠ¸ ì¤‘...';
            await loadData();
            this.disabled = false;
            this.textContent = 'ğŸ”„ ìƒˆë¡œê³ ì¹¨';
        });

        // ì´ˆê¸° ë¡œë“œ
        loadData();

        // ìë™ ìƒˆë¡œê³ ì¹¨ (1ë¶„ë§ˆë‹¤)
        setInterval(loadData, 60000);
    </script>
</body>
</html>
