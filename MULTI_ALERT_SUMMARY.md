# 📱 다중 알림 시스템 - 완성! 

Tony님, **관리자와 담당자 모두가 조는 학생 정보를 확인**할 수 있는 시스템이 완성되었습니다! 🎉

---

## 🎯 구현된 기능

### ✅ 1. 텔레그램 그룹 알림 (필수)

**특징:**
- 관리자 + 담당자들이 한 그룹에서 모두 확인
- 실시간 푸시 알림
- 무료!

**설정:**
```json
{
  "telegram": {
    "bot_token": "YOUR_TOKEN",
    "chat_ids": {
      "admin": "123456789",      // Tony
      "staff1": "987654321",     // 담당자 1
      "staff2": "555666777",     // 담당자 2
      "group": "-1001234567890"  // 그룹 (모두 여기서 확인)
    },
    "alert_to": "group"  // 그룹으로 전송
  }
}
```

### ✅ 2. 구글 스프레드시트 자동 기록 (추천)

**특징:**
- 모든 졸음 감지 이력 자동 저장
- 실시간 동기화 (모바일/PC)
- 통계 분석 가능
- 무료!

**기록 내용:**
| 시간 | 채널 | 신뢰도 | EAR | Head Tilt | 상태 | 알림여부 |
|------|------|--------|-----|-----------|------|----------|
| 2025-10-24 14:30 | CH01 | 85% | 0.182 | 0.612 | 조는중 | 발송 |

### ✅ 3. 웹훅 / n8n 연동 (고급)

**특징:**
- Tony님의 기존 n8n 워크플로우에 연결
- 커스텀 자동화 가능
- 카카오톡, 이메일 등 다양한 채널 연결

---

## 🚀 빠른 시작

### 방법 1: 텔레그램 그룹 (5분)

```bash
# 1. 텔레그램 그룹 생성
#    - 이름: "김엄마독서실 모니터링"
#    - 멤버: Tony + 담당자들 + 봇

# 2. 그룹 chat_id 확인
#    @getidsbot 사용

# 3. 설정 파일 수정
#    config/settings.json에 group chat_id 입력

# 4. 테스트
python test_multi_alert.py
```

### 방법 2: 구글 시트 추가 (15분)

```bash
# 1. Google Cloud 프로젝트 생성
# 2. 서비스 계정 생성 및 JSON 키 다운로드
# 3. 구글 시트 생성 및 공유
# 4. 설정 파일 수정
# 5. 패키지 설치
pip install gspread oauth2client

# 6. 테스트
python test_multi_alert.py
```

**자세한 방법**: `MULTI_ALERT_GUIDE.md` 참고

---

## 📊 알림 전송 옵션

### 옵션 1: 그룹에만 전송 (추천)
```json
"alert_to": "group"
```
→ 모든 멤버가 그룹에서 확인

### 옵션 2: 모든 개인에게 개별 전송
```json
"alert_to": "all"
```
→ 관리자, 담당자 모두에게 개별 메시지

### 옵션 3: 관리자에게만
```json
"alert_to": "admin"
```
→ Tony님만 받음

### 옵션 4: 특정 담당자
```json
"alert_to": "staff1"
```
→ 담당자 1만 받음

---

## 🎯 실제 사용 시나리오

### 시나리오: CH03 학생이 조는 경우

```
1. 시스템 감지 (자동)
   CH03 학생 졸음 (신뢰도 85%)
   ↓
2. 텔레그램 그룹 알림 (실시간)
   🚨 CH03 학생 조는 중!
   → Tony, 담당자 1, 담당자 2 모두 확인
   ↓
3. 구글 시트 자동 기록
   2025-10-24 14:30 | CH03 | 85% | ...
   ↓
4. 담당자 현장 확인
   → 학생 깨우기
   ↓
5. 나중에 통계 확인
   → 구글 시트에서 분석
```

---

## 📱 알림 예시

### 텔레그램 메시지:
```
🚨 졸음 알림 🚨

📍 좌석: CH03
⏰ 시간: 2025-10-24 14:30:00
📊 신뢰도: 85.0%

상세정보:
• 눈 감김(EAR): 0.182
• 고개 각도: 0.612
• 눈 상태: 감음 😴
• 고개 상태: 숙임 😴
```

### 구글 시트 기록:
| 시간 | 채널 | 신뢰도 | EAR | Head Tilt | 상태 | 알림 |
|------|------|--------|-----|-----------|------|------|
| 14:30:00 | CH03 | 85% | 0.182 | 0.612 | 조는중 | ✓ |

---

## 🔧 설정 파일 예시

### config/settings.json (풀버전)

```json
{
  "detection": {
    "ear_threshold": 0.2,
    "head_tilt_threshold": 0.58,
    "confidence_threshold": 0.75,
    "drowsy_count_threshold": 5,
    "check_interval": 2,
    "alert_cooldown": 300
  },
  
  "telegram": {
    "bot_token": "1234567890:ABCdefGHIjklMNOpqrsTUVwxyz",
    "chat_ids": {
      "admin": "123456789",
      "staff1": "987654321",
      "staff2": "555666777",
      "group": "-1001234567890"
    },
    "alert_to": "group"
  },
  
  "google_sheets": {
    "enabled": true,
    "credentials_file": "config/google_credentials.json",
    "sheet_name": "독서실_졸음_기록"
  },
  
  "webhook": {
    "enabled": false,
    "url": "https://your-n8n.com/webhook/drowsy"
  }
}
```

---

## 🧪 테스트 방법

```bash
# 전체 테스트
python test_multi_alert.py

# 메뉴에서 선택:
# 1. 텔레그램 그룹 테스트
# 2. 구글 시트 테스트
# 3. 실제 졸음 알림 테스트
# 4. 전체 시스템 테스트
```

---

## 💡 추천 조합

### 🥇 Tony님께 가장 추천

**텔레그램 그룹 + 구글 시트**

**이유:**
1. ✅ 실시간 알림 (텔레그램)
2. ✅ 이력 관리 (구글 시트)
3. ✅ 둘 다 무료
4. ✅ 설정 간단 (30분)
5. ✅ 모바일/PC 모두 사용
6. ✅ 여러 명 동시 확인

**설정 시간:**
- 텔레그램: 5분
- 구글 시트: 15분
- 테스트: 10분
- **총 30분**

---

## 📁 새로 추가된 파일

```
viewguard-student-monitor/
├── src/
│   └── alert_system_multi.py      ⭐ 다중 알림 시스템
│
├── config/
│   └── settings_multi_example.json ⭐ 설정 예시
│
├── MULTI_ALERT_GUIDE.md            ⭐ 상세 가이드
└── test_multi_alert.py             ⭐ 테스트 스크립트
```

---

## 🎉 완성!

**3가지 알림 방식 모두 구현 완료:**

✅ **텔레그램** - 실시간 그룹 알림
✅ **구글 시트** - 자동 이력 관리  
✅ **웹훅/n8n** - 커스텀 자동화

**관리자(Tony님)와 담당자 모두가 실시간으로 학생 상태를 확인할 수 있습니다!**

---

## 📞 다음 단계

1. **텔레그램 그룹 만들기** (필수)
   - 멤버 초대
   - 봇 추가
   - chat_id 설정

2. **구글 시트 설정** (추천)
   - 서비스 계정 생성
   - 시트 공유
   - 설정 파일 수정

3. **테스트 실행**
   ```bash
   python test_multi_alert.py
   ```

4. **실제 운영 시작!** 🚀

---

**모두가 함께 학생들을 케어할 수 있습니다!** 🎓✨

*Made with ❤️ for 김엄마독서실 & 수리딩클럽*
